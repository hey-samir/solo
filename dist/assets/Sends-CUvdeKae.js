var M=r=>{throw TypeError(r)};var S=(r,e,t)=>e.has(r)||M("Cannot "+t);var n=(r,e,t)=>(S(r,e,"read from private field"),t?t.call(r):e.get(r)),g=(r,e,t)=>e.has(r)?M("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),N=(r,e,t,i)=>(S(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t),v=(r,e,t)=>(S(r,e,"access private method"),t);import{r as y,j as s,a as G,c as C}from"./main-XbrgEMxt.js";import{S as T,s as B,h as O,n as q,a as U,b as Q,c as H,u as I}from"./useQuery-CoxOj_e5.js";function W(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var b,f,o,d,h,F,w,k,Y=(k=class extends T{constructor(e,t){super();g(this,h);g(this,b);g(this,f);g(this,o);g(this,d);N(this,b,e),this.setOptions(t),this.bindMethods(),v(this,h,F).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const t=this.options;this.options=n(this,b).defaultMutationOptions(e),B(this.options,t)||n(this,b).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,o),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&O(t.mutationKey)!==O(this.options.mutationKey)?this.reset():((i=n(this,o))==null?void 0:i.state.status)==="pending"&&n(this,o).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=n(this,o))==null||e.removeObserver(this)}onMutationUpdate(e){v(this,h,F).call(this),v(this,h,w).call(this,e)}getCurrentResult(){return n(this,f)}reset(){var e;(e=n(this,o))==null||e.removeObserver(this),N(this,o,void 0),v(this,h,F).call(this),v(this,h,w).call(this)}mutate(e,t){var i;return N(this,d,t),(i=n(this,o))==null||i.removeObserver(this),N(this,o,n(this,b).getMutationCache().build(n(this,b),this.options)),n(this,o).addObserver(this),n(this,o).execute(e)}},b=new WeakMap,f=new WeakMap,o=new WeakMap,d=new WeakMap,h=new WeakSet,F=function(){var t;const e=((t=n(this,o))==null?void 0:t.state)??W();N(this,f,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},w=function(e){q.batch(()=>{var t,i,c,x,u,p,a,l;if(n(this,d)&&this.hasListeners()){const m=n(this,f).variables,j=n(this,f).context;(e==null?void 0:e.type)==="success"?((i=(t=n(this,d)).onSuccess)==null||i.call(t,e.data,m,j),(x=(c=n(this,d)).onSettled)==null||x.call(c,e.data,null,m,j)):(e==null?void 0:e.type)==="error"&&((p=(u=n(this,d)).onError)==null||p.call(u,e.error,m,j),(l=(a=n(this,d)).onSettled)==null||l.call(a,void 0,e.error,m,j))}this.listeners.forEach(m=>{m(n(this,f))})})},k);function $(r,e){const t=U(),[i]=y.useState(()=>new Y(t,r));y.useEffect(()=>{i.setOptions(r)},[i,r]);const c=y.useSyncExternalStore(y.useCallback(u=>i.subscribe(q.batchCalls(u)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),x=y.useCallback((u,p)=>{i.mutate(u,p).catch(Q)},[i]);if(c.error&&H(i.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:x,mutateAsync:c.mutate}}const z={White:"#FFFFFF",Pink:"#FF69B4",Blue:"#0000FF",Black:"#000000",Orange:"#FFA500",Purple:"#800080",Green:"#008000",Red:"#FF0000",Yellow:"#FFFF00",Teal:"#008080"},ee=()=>{const[r,e]=y.useState({route_id:0,tries:1,status:!0,rating:3,notes:""}),{data:t,isLoading:i}=I({queryKey:["routes"],queryFn:async()=>(await C.get("/routes")).data}),c=$({mutationFn:async a=>await C.post("/climbs",a),onSuccess:()=>{e({route_id:0,tries:1,status:!0,rating:3,notes:""})}}),x=(a,l,m,j)=>{if(!a)return 0;const[J,E,R]=a.match(/5\.(\d+)([a-d])?/)||[null,"0",""],P={5:50,6:60,7:70,8:80,9:100,10:150,11:200,12:300,13:400,14:500,15:600},_={a:1,b:1.1,c:1.2,d:1.3},K=(P[E]||0)*(_[R]||1),L=Math.max(.1,l/3),A=m?1:.5,D=Math.max(.1,1/Math.sqrt(j));return Math.round(K*L*A*D)};if(i)return s.jsx(G,{});const u=t==null?void 0:t.find(a=>a.id===r.route_id),p=u?x(u.grade,r.rating,r.status,r.tries):0;return s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"card",children:s.jsx("div",{className:"card-body p-0",children:s.jsxs("form",{onSubmit:a=>{a.preventDefault(),c.mutate(r)},className:"w-100",children:[s.jsx("table",{className:"table table-form w-100",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"form-label-cell",children:s.jsx("label",{className:"form-label required-field",children:"Route"})}),s.jsx("td",{className:"form-input-cell",children:s.jsxs("select",{className:"form-select form-select-lg custom-select",value:r.route_id||"",onChange:a=>e(l=>({...l,route_id:Number(a.target.value)})),required:!0,children:[s.jsx("option",{value:"",disabled:!0,children:"Select a route"}),t==null?void 0:t.map(a=>s.jsxs("option",{value:a.id,className:"route-option",children:[s.jsx("span",{className:"color-dot",style:{backgroundColor:z[a.color]||"#FFFFFF"}}),a.wall_sector," - ",a.anchor_number," - ",a.color," ",a.grade]},a.id))]})})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"form-label-cell",children:s.jsx("label",{className:"form-label required-field",children:"Tries"})}),s.jsx("td",{className:"form-input-cell",children:s.jsxs("div",{className:"d-flex align-items-center gap-3",children:[s.jsx("input",{type:"range",min:"1",max:"10",value:r.tries,onChange:a=>e(l=>({...l,tries:Number(a.target.value)})),className:"form-range"}),s.jsx("span",{className:"text-white",children:r.tries})]})})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"form-label-cell",children:s.jsx("label",{className:"form-label required-field",children:"Status"})}),s.jsx("td",{className:"form-input-cell",children:s.jsxs("div",{className:"form-check form-switch",children:[s.jsx("input",{className:"form-check-input custom-switch",type:"checkbox",role:"switch",checked:r.status,onChange:a=>e(l=>({...l,status:a.target.checked}))}),s.jsx("label",{className:"form-check-label",children:r.status?"Sent":"Attempted"})]})})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"form-label-cell",children:s.jsx("label",{className:"form-label required-field",children:"Stars"})}),s.jsx("td",{className:"form-input-cell",children:s.jsx("div",{className:"rating-container",children:s.jsx("div",{className:"rating",children:[1,2,3,4,5].map(a=>s.jsx("i",{className:`rating-star bi bi-star-fill ${a<=r.rating?"active":""}`,onClick:()=>e(l=>({...l,rating:a}))},a))})})})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"form-label-cell",children:s.jsx("label",{className:"form-label",children:"Notes"})}),s.jsx("td",{className:"form-input-cell",children:s.jsx("textarea",{className:"form-control form-control-lg",rows:3,value:r.notes,onChange:a=>e(l=>({...l,notes:a.target.value}))})})]})]})}),s.jsxs("div",{className:"px-3 pb-3 w-100",children:[s.jsx("button",{type:"submit",className:"btn btn-primary btn-lg w-100",disabled:c.isPending,children:c.isPending?"Sending...":r.status?"Send":"Log"}),s.jsxs("div",{className:"text-white mt-3 text-center fs-6",children:["Points: ",p]})]})]})})})})};export{ee as default};
